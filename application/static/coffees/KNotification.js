// Generated by CoffeeScript 1.5.0
(function() {
  var KNotification, delay;

  delay = function(ms, func) {
    return setTimeout(func, ms);
  };

  KNotification = {
    /*
    KNotification tool.
    */

    width: 250,
    height: 75,
    prefix: 'n_',
    increment_id: 0,
    queue: [],
    pop: function(arg) {
      /*
      pop notification box.
      */

      var box, nid, top, _ref, _ref1, _ref2;
      if ((_ref = arg.expire) == null) {
        arg.expire = 5000;
      }
      if ((_ref1 = arg.title) == null) {
        arg.title = '';
      }
      if ((_ref2 = arg.message) == null) {
        arg.message = '';
      }
      nid = this.prefix + ++this.increment_id;
      box = $('<div id="' + nid + '" class="knotification"><div class="ntitle">' + arg.title + '</div><div class="nmessage">' + arg.message + '</div></div>');
      top = this.queue.length * this.height;
      this.queue.push(nid);
      $('body').append(box);
      $('#' + nid).css({
        right: -this.width,
        top: top
      });
      $('#' + nid).animate({
        right: 0
      }, 400, 'easeOutExpo', delay(arg.expire, function() {
        return KNotification.hide(nid);
      }));
      return nid;
    },
    hide: function(nid) {
      /*
      hide notification box.
      */

      var remove_top;
      this.queue = this.queue.filter(function(x) {
        return x !== nid;
      });
      remove_top = parseInt($('#' + nid).css('top'));
      $('#' + nid).animate({
        right: -this.width
      }, 400, 'easeInExpo', function() {
        var $box, id, new_top, top, _i, _len, _ref;
        _ref = KNotification.queue;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          id = _ref[_i];
          $box = $('#' + id);
          top = parseInt($box.css('top'));
          if (top > remove_top) {
            new_top = $box.attr('top') ? parseInt($box.attr('top' - KNotification.height)) : top - KNotification.height;
            $box.attr({
              'top': new_top
            });
            $box.dequeue();
            $box.animate({
              top: new_top
            }, 400, 'easeOutExpo');
          }
        }
        return $(this).remove();
      });
    }
  };

  window.KNotification = KNotification;

}).call(this);
